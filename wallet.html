<!DOCTYPE html>
<html class="no-js">
<head>
	<!-- Global String Sripts -->
	<script src="./script/string.js" type="text/javascript"></script>
	<meta charset="utf-8">
	<title>Dabble</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="author" content="Hark Hark Hark">
	<meta name="Description" content="">
	
	<!-- Favicons -->
	<link rel="apple-touch-icon" sizes="196x196" href="favicon-196x196.png" />
	<link rel="shortcut icon" href="favicon-196x196.png" />
	<link rel="icon" type="image/png" href="favicon-196x196.png" sizes="196x196" />
	<meta name="application-name" content="Dabble"/>
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="mstile-144x144.png" />
	<meta name="msapplication-square70x70logo" content="mstile-70x70.png" />
	<meta name="msapplication-square150x150logo" content="mstile-150x150.png" />
	<meta name="msapplication-wide310x150logo" content="mstile-310x150.png" />
	<meta name="msapplication-square310x310logo" content="mstile-310x310.png" />
	<!-- Favicons -->

	<!-- Sripts -->
	<link href="./style/common.import.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<script src="./script/modernizr.js" type="text/javascript"></script>
	<script src="./script/jquery-1.12.4.min.js" type="text/javascript"></script>
	<script src="./script/jquery.isotope.load.js" type="text/javascript"></script>
	<script>
		$(function(){
			gfIsLoginAction(userInfoCallback);
		});
		
		function userInfoCallback(data){
			if ( "true" == data.result ){
				$("#frmUserInfo #id").val(data.id)
				getWalletAction();
			}else{
				alert("로그인 후 사용하세요.");
				$(location).attr("href", "index.html");
			}
		}
		
		function getWalletAction(){
			var sAction = "/getWallet";
			$("#frmWallet #user").val($("#frmUserInfo #id").val());
			var fnCallback = getWalletActionCallback;
			gfAjaxCallWithForm(sAction,$('#frmWallet'),fnCallback,"POST");
		}
		function getWalletActionCallback(data){
			if ( "OK" == data.result ){
				$("#tokenBalance").text(data.balance +" DAB");
				if ( "" == data.account ){
					alert("등록된 eos account 가 없습니다.");
					$("#btnChangeAccount").hide();
					$("#btnAccountSave").show();
					$("#btnAccountSaveCancel").show();
					$("#eosaccount").attr("readonly", false);
				}else{
					$("#btnChangeAccount").show();
					$("#btnAccountSave").hide();
					$("#eosaccount").val(data.account);
					
					
				}
				//gfMsgBox(data.resultMsg, "핡~!", false, fnInsertAccountSuccessCallback);
			}else{
				alert("지갑조회실패");
			}
		}
		
		function fnEosAccountChange(){
			$("#btnChangeAccount").hide();
			$("#btnAccountSave").show();
			$("#btnAccountSaveCancel").show();
			$("#eosaccount").attr("readonly", false);

//			$("#btnChangeAccount").show();
			//$("#btnAccountSave").hide();
 		}
		
		function fnEosAccountChangeCancel(){
			$("#btnChangeAccount").show();
			$("#btnAccountSave").hide();
			$("#btnAccountSaveCancel").hide();
			$("#eosaccount").attr("readonly", true);

//			$("#btnChangeAccount").show();
			//$("#btnAccountSave").hide();
 		}
		
		function fnEosAccountSave(){
			var regex = /^[a-z1-5]{12}$/;
			if ( !regex.test($("#eosaccount").val()) ){
				//alert("eos account는 소문자 a부터 z까지, 숫자 1부터 5까지 구성된 12자리입니다.\neos account가 맞는지 확인바랍니다.\nex)\nabcdefg12345 (O), abcdefg67890 숫자 0, 6이상(X), aaaaaaaaaaaaa 계정13자리(X)");
				alert("eos account는 소문자 a부터 z까지, 숫자 1부터 5까지 구성된 12자리입니다. \nex)abcdefg12345 (O), abcdefg67890 (X)");
				return;
			}
			
			var sAction = "/setwallet";
			$("#frmWallet #account").val($("#eosaccount").val());
			var fnCallback = fnEosAccountSaveCallback;
			gfAjaxCallWithForm(sAction,$('#frmWallet'),fnCallback,"POST");
		}
		
		function fnEosAccountSaveCallback(data){
			if ( "OK" == data ){
				$("#btnChangeAccount").show();
				$("#btnAccountSave").hide();
				$("#btnAccountSaveCancel").hide();
				$("#eosaccount").attr("readonly", true);
				alert("수정 되었습니다.");
				getWalletAction();
				
			}else{
				$("#btnChangeAccount").hide();
				$("#btnAccountSave").show();
				$("#btnAccountSaveCancel").show();
				$("#eosaccount").attr("readonly", false);
			}
		}
		
		function fnTrasnferMyWallet(){
			if ( "" == $("#eosaccount").val().trim() ){
				alert("지갑을 먼저 등록하세요.");
				return ;
			}
			if ( !$("#eosaccount").prop("readonly") ){
				alert("지갑이 변경중이면 내 지갑으로 전송을 할 수 없습니다. 취소 버튼을 누른 후 다시 시도해주세요.");
				return ;
			}
			
			$("#btnTransfer").attr("readonly", true);
			var sAction = "/transferbalance";
			var fnCallback = fnTrasnferMyWalletCallback;
			var param = "";
			var sMethod = "POST";
			gfAjaxCallWithParam(sAction, param, fnCallback, sMethod);
		
		}
		
		function fnTrasnferMyWalletCallback(data){
			if ( "success" == data ){
				alert("내 지갑으로 전송하였습니다.");
				getWalletAction();
			}else{
				alert("내 지갑으로 전송을 실패 하였습니다.");
			}
			$("#btnTransfer").attr("readonly", false);
		}
		
		
		
	</script>
    
    <!-- Scripts -->
  </head>
<body>
	<div id="wrap">
		<div id="menu-button">
			<table style="width: 100%;">
			<colgroup>
			<col width="25%;">
			<col width="50%;">
			<col width="25%;">
			</colgroup>
				<tr>
					<td> 
						<div class="left">
							<div class="cursor">
								<div id="nav-button">
									<span class="nav-bar"></span>
									<span class="nav-bar"></span>
									<span class="nav-bar"></span>
								</div>
							</div>
						</div>
					</td>
					<td>
						<div class="center">
							<div class="cursor">
								<a href="index.html" style="align-self: center;" >
									<img  src="./images/logo-dabble.png" style="width: 130px; height: 50px; vertical-align: super; display: inline;" />
								</a>
							</div>
						</div>
					</td>
					<td>
						<div class="right">
							<div class="cursor">
								<div id="nav-button">
									<span class="nav-bar"> </span>
									<span class="nav-bar"></span>
									<span class="nav-bar"></span>
								</div>
							</div>
						</div>
					</td>
				</tr>
			</table>
		</div>
		
		<!-- start header -->
		<header id="header" class="clearfix">
			<h1 id="logo"><a href="index.html">Dabble</a></h1>
			<!-- start main nav -->
			<h4 id="headertitle"></h4>
			<nav id="main-nav">
				<ul class="clearfix" id="options">
					<li> <a href="/intro/index.html">데블소개</a></li>
					<li> <a href="/Dabble_White_Paper.pdf" target="_blank">백서</a></li>
					<li> <a href="/notice.html">공지사항</a></li>
					<li> <a href="/snapshot.html">에어드랍 확인</a></li>
					<li style="display: none;" id="linkUserInfo"> <a href="./userinfo.html">회원정보</a></li>
					<li style="display: none;" id="linkMyContents"> <a href="./myContentList.html">나불데블</a></li>
					<li style="display: none;" id="linkFollow"> <a href="./follow.html">친구정보</a></li>
					<li style="display: none;" id="linkLogin" >   <a href="./login.html">로그인</a></li>
					<!-- <li style="display: none;" id="linkWallet"> <a href="./wallet.html">지갑</a></li> -->
					<li style="display: none;" id="linkSingup"> <a href="./signup.html">회원가입</a></li>
					<li style="display: none;" id="linkLogout" >  <a href="javascript:gfLogoutAction();">로그아웃</a></li>
				</ul>
			</nav>
			<!-- end main nav -->
		</header>
		<!-- end header -->

		<!-- start content -->
		<div id="content">
			<div class="container clearfix">
		    <!-- GLOBAL ALERT BANNER -->
			<!-- END GLOBAL ALERT BANNER -->
			
				<h4 id="headertitle-inner"></h4>
				<div id="container">
					<div id="contentList">
						<div class="element tile-2 home bg-change">
						<h4 style="text-align: center;">내 토큰 관리</h4>
						토큰잔액
							<h4 id="tokenBalance" class="header icon-to-the-right">0 DAB</h4>
		                
							<div class="form-group">
								<label class="col-form-label" for="inputDefault">내 지갑주소</label>
								<input class="form-control"  id="eosaccount" readonly="readonly" type="text" placeholder="">
							</div>
							<div class="form-group">

								<button type="button" class="btn btn-primary btn-block" onClick="javascript:fnEosAccountChange();" id="btnChangeAccount" >변경</button>
								<!-- <button type="button" id="btnChangeAccount" onClick="javascript:fnEosAccountChange();" style="width: 40%;" class="btn btn-primary">변경</button> -->
								<button type="button" id="btnAccountSave" style="width: 49%; display: none;" onClick="javascript:fnEosAccountSave();" class="btn btn-primary">저장</button>
								<button type="button" id="btnAccountSaveCancel" style="width: 49%; display: none;" onClick="javascript:fnEosAccountChangeCancel();" class="btn btn-primary">취소</button>
							</div>

							<div class="form-group">
								<button type="button" id="btnTransfer" class="btn btn-primary btn-block" onClick="javascript:fnTrasnferMyWallet();">내 지갑으로 전송</button>
							</div>
						</div>
						
			            <!-- END LANDING PAGE ITEMS -->
			
			            <!-- CALCULATE PAGE ITEMS -->
            			<!-- END CALCULATE PAGE ITEMS -->
            		</div>
				</div>
			</div>
		</div>
	<!-- end content -->


		<!-- start footer -->
		<footer id="footer">
			<div class="container clearfix">
				<div class="col">
					<div class="col" id="sourcecode">
						<p>copyright, 2018, EOSIX<br />
							<a href="javascript:;" target="_blank" title="">링크</a>
						</p>
					</div>
					<div class="col">
						<ul class="social-list clearfix col">
							<li> <a href="https://t.me/eoscafe_korea"><i class="fa fa-telegram"></i></a> </li>
							<li> <a href="mailto:"><i class="fa fa-envelope"></i></a> </li>
							<li> <a href="https:"><i class="fa fa-meetup"></i></a> </li>
							<li> <a href="https:"><i class="fa fa-medium"></i></a> </li>
							<li> <a href="https:"><i class="fa fa-youtube"></i></a> </li>
							<li> <a href="https"><i class="fa fa-twitter"></i></a> </li>
						</ul>
						<a class="col" id="dabblelogo" href="https://dabbledabble.herokuapp.com/"></a>
					</div>
				</div>
			</div>
		</footer>
		<!-- end footer -->
	</div>
      
	<form id="frmWallet">
		<input type="hidden" id="user"   name="user" />
		<input type="hidden" id="account"   name="account" />
	</form>
	
	<form id="frmUserInfo">
		<input type="hidden" id="id"   name="id" />
	</form>
	<!-- end form -->	
	
</body>
<script src="./script/jquery-easing-1.3.js" type="text/javascript"></script>
<script src="./script/jquery.touchSwipe.min.js" type="text/javascript"></script>
<script src="./script/jquery.isotope2.min.js" type="text/javascript"></script>
<script src="./script/jquery.ba-bbq.min.js" type="text/javascript"></script>
<script src="./script/packery-mode.pkgd.min.js" type="text/javascript"></script>
<script src="./script/main.js" type="text/javascript"></script>
<script src="./script/jquery.form.js" type="text/javascript"></script>
<script src="./script/bootstrap.min.js" type="text/javascript"></script>
<script src="./script/jquery.fancybox.pack.js" type="text/javascript"></script>
<script src="./script/common.js" type="text/javascript"></script>
<script src="./script/dabble.js" type="text/javascript"></script>
</html>
